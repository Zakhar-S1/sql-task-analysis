## Logic

To solve the problem of finding the date with the maximum change in the USD→CAD exchange rate, a multi-step approach is used with CTE (Common Table Expressions) and window functions. The first step is to create a CTE named daily_changes, where data is filtered by the USD→CAD currency pair and daily exchange rate changes are calculated. To obtain the previous day's rate, the LAG(EndOfDayRate) OVER (ORDER BY CurrencyRateDate) function is used, which shifts the values back one row in chronological order. The absolute change in the rate is calculated using the ABS() function, which is applied to the difference between the current and previous rates, allowing changes to be taken into account regardless of their direction (increase or decrease). In the second stage, a CTE ranked_changes is created, where the RANK() OVER (ORDER BY RateChange DESC) function is applied to the results of the first stage to assign ranks to changes in descending order, while records with NULL values (the first record without the previous day) are excluded through the WHERE RateChange IS NOT NULL condition. The final selection filters the results by the condition rnk = 1, which returns the date or dates with the maximum exchange rate change. The advantage of using RANK() is that if several days have the same maximum change, the function will correctly assign them all a rank of 1 and display all such records, unlike the ROW_NUMBER() or LIMIT functions, which can arbitrarily select one of them. The query result includes the date of the maximum change, the exchange rate on that date, the exchange rate of the previous day, and the size of the change, which provides a complete picture of currency volatility and allows you to analyze the most significant fluctuations in the USD→CAD exchange rate.